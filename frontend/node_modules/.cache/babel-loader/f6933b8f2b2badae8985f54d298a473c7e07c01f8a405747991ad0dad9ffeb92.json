{"ast":null,"code":"import api from'../utils/api';import{useState,useEffect}from'react';import{useHistory}from'react-router-dom';import useFlashMessage from'./useFlashMessage';export default function useAuth(){const[authenticated,setAuthenticated]=useState(false);const[loading,setLoading]=useState(true);const history=useHistory();const{setFlashMessage}=useFlashMessage();useEffect(()=>{const token=localStorage.getItem('token');if(token){api.defaults.headers.Authorization=\"Bearer \".concat(JSON.parse(token));setAuthenticated(true);}setLoading(false);},[]);async function register(user){let msgText='Cadastro realizado com sucesso!';let msgType='success';try{const data=await api.post('/users/register',user).then(response=>{return response.data;});await authUser(data);}catch(error){// tratar erro\nmsgText=error.response.data.message;msgType='error';}setFlashMessage(msgText,msgType);}async function login(user){let msgText='Login realizado com sucesso!';let msgType='success';try{const data=await api.post('/users/login',user).then(response=>{return response.data;});await authUser(data);}catch(error){// tratar erro\nmsgText=error.response.data.message;msgType='error';}setFlashMessage(msgText,msgType);}async function authUser(data){setAuthenticated(true);localStorage.setItem('token',JSON.stringify(data.token));history.push('/');}function logout(){const msgText='Logout realizado com sucesso!';const msgType='success';setAuthenticated(false);localStorage.removeItem('token');api.defaults.headers.Authorization=undefined;history.push('/login');setFlashMessage(msgText,msgType);}return{authenticated,loading,register,login,logout};}","map":{"version":3,"names":["api","useState","useEffect","useHistory","useFlashMessage","useAuth","authenticated","setAuthenticated","loading","setLoading","history","setFlashMessage","token","localStorage","getItem","defaults","headers","Authorization","concat","JSON","parse","register","user","msgText","msgType","data","post","then","response","authUser","error","message","login","setItem","stringify","push","logout","removeItem","undefined"],"sources":["D:/Projetos/Node/15_GETAPET/frontend/src/hooks/useAuth.js"],"sourcesContent":["import api from '../utils/api'\n\nimport { useState, useEffect } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport useFlashMessage from './useFlashMessage'\n\nexport default function useAuth() {\n  const [authenticated, setAuthenticated] = useState(false)\n  const [loading, setLoading] = useState(true)\n  const history = useHistory()\n  const { setFlashMessage } = useFlashMessage()\n\n  useEffect(() => {\n    const token = localStorage.getItem('token')\n\n    if (token) {\n      api.defaults.headers.Authorization = `Bearer ${JSON.parse(token)}`\n      setAuthenticated(true)\n    }\n\n    setLoading(false)\n  }, [])\n\n  async function register(user) {\n    let msgText = 'Cadastro realizado com sucesso!'\n    let msgType = 'success'\n\n    try {\n      const data = await api.post('/users/register', user).then((response) => {\n        return response.data\n      })\n\n      await authUser(data)\n    } catch (error) {\n      // tratar erro\n      msgText = error.response.data.message\n      msgType = 'error'\n    }\n\n    setFlashMessage(msgText, msgType)\n  }\n\n  async function login(user) {\n    let msgText = 'Login realizado com sucesso!'\n    let msgType = 'success'\n\n    try {\n      const data = await api.post('/users/login', user).then((response) => {\n        return response.data\n      })\n\n      await authUser(data)\n    } catch (error) {\n      // tratar erro\n      msgText = error.response.data.message\n      msgType = 'error'\n    }\n\n    setFlashMessage(msgText, msgType)\n  }\n\n  async function authUser(data) {\n    setAuthenticated(true)\n    localStorage.setItem('token', JSON.stringify(data.token))\n\n    history.push('/')\n  }\n\n  function logout() {\n    const msgText = 'Logout realizado com sucesso!'\n    const msgType = 'success'\n\n    setAuthenticated(false)\n    localStorage.removeItem('token')\n    api.defaults.headers.Authorization = undefined\n    history.push('/login')\n\n    setFlashMessage(msgText, msgType)\n  }\n\n  return { authenticated, loading, register, login, logout }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}